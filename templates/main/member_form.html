{% extends "base.html" %}
{% import 'macros/responsive.html' as responsive %}
{% block title %}Add New Member{% endblock %}

<!-- Reusable Form Partial -->
{% macro render_member_form(is_mobile=false) %}
        <form id="memberForm" action="{{ url_for('main.add_member') }}" method="POST" novalidate>
            <!-- Hidden fields for auto-generated data -->
            <input type="hidden" name="leader_id" value="{{ session.user.id if session.user else '' }}">
            <!-- Full Name - Required Field -->
    <div style="margin-bottom: {{ '20px' if is_mobile else '24px' }};">
        <label for="name" style="display: block; color: #B1BAC4; font-weight: 600; margin-bottom: {{ '10px' if is_mobile else '12px' }}; font-size: {{ '16px' if is_mobile else '16px' }}; line-height: 1.4;">
                    <i class="fas fa-user" style="margin-right: 8px; color: #1F6FEB;"></i>Full Name <span style="color: #F85149;">*</span>
                </label>
                <input type="text" 
                       id="name" 
                       name="name" 
                       required 
                       placeholder="Enter full name" 
                       maxlength="100" 
                       pattern="[A-Za-z\s]{2,100}" 
                       title="Name must be 2-100 characters, letters and spaces only"
                       value="{{ request.form.name if request.form.name else '' }}"
               style="width: 100%; padding: {{ '14px 18px' if is_mobile else '16px 20px' }}; border: 2px solid #30363D; border-radius: {{ '12px' if is_mobile else '10px' }}; background: #0D1117; color: #B1BAC4; font-size: {{ '16px' if is_mobile else '16px' }}; transition: all 0.3s ease; box-sizing: border-box; min-height: {{ '52px' if is_mobile else '48px' }};"
                       onfocus="this.style.borderColor='#1F6FEB'; this.style.background='#161B22'; this.style.boxShadow='0 0 0 3px rgba(31, 111, 235, 0.1)';"
                       onblur="this.style.borderColor='#30363D'; this.style.background='#0D1117'; this.style.boxShadow='none';">
        <div style="color: #6E7681; font-size: {{ '14px' if is_mobile else '14px' }}; margin-top: {{ '8px' if is_mobile else '8px' }}; font-weight: 500;">Required field - 2-100 characters, letters and spaces only</div>
                {% if form_errors and 'name' in form_errors %}
            <div style="color: #F85149; font-size: {{ '14px' if is_mobile else '14px' }}; margin-top: {{ '6px' if is_mobile else '8px' }}; font-weight: 500;">{{ form_errors.name }}</div>
                {% endif %}
            </div>
    <!-- Age - Optional Field -->
    <div style="margin-bottom: {{ '12px' if is_mobile else '16px' }};">
        <label for="age" style="display: block; color: #B1BAC4; font-weight: 600; margin-bottom: {{ '6px' if is_mobile else '8px' }}; font-size: {{ '15px' if is_mobile else '16px' }};">
            <i class="fas fa-calendar" style="margin-right: 8px; color: #1F6FEB;"></i>Age
                    </label>
                    <input type="number" 
                           id="age" 
                           name="age" 
               placeholder="Enter age" 
                           min="1" 
                           max="120" 
                           value="{{ request.form.age if request.form.age else '' }}"
               style="width: 100%; padding: {{ '10px 14px' if is_mobile else '12px 16px' }}; border: 2px solid #30363D; border-radius: 8px; background: #0D1117; color: #B1BAC4; font-size: {{ '15px' if is_mobile else '16px' }}; transition: all 0.3s ease; box-sizing: border-box;"
                           onfocus="this.style.borderColor='#1F6FEB'; this.style.background='#161B22';"
                           onblur="this.style.borderColor='#30363D'; this.style.background='#0D1117';">
        <div style="color: #6E7681; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">Optional - Age between 1-120</div>
                    {% if form_errors and 'age' in form_errors %}
            <div style="color: #F85149; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">{{ form_errors.age }}</div>
                    {% endif %}
                </div>
    <!-- Gender - Optional Field -->
    <div style="margin-bottom: {{ '12px' if is_mobile else '16px' }};">
        <label for="gender" style="display: block; color: #B1BAC4; font-weight: 600; margin-bottom: {{ '6px' if is_mobile else '8px' }}; font-size: {{ '15px' if is_mobile else '16px' }};">
            <i class="fas fa-venus-mars" style="margin-right: 8px; color: #1F6FEB;"></i>Gender
                    </label>
                    <select id="gender" 
                            name="gender"
                            style="width: 100%; padding: {{ '10px 14px' if is_mobile else '12px 16px' }}; border: 2px solid #30363D; border-radius: 8px; background: #0D1117; color: #B1BAC4; font-size: {{ '15px' if is_mobile else '16px' }}; transition: all 0.3s ease; box-sizing: border-box;"
                            onfocus="this.style.borderColor='#1F6FEB'; this.style.background='#161B22';"
                            onblur="this.style.borderColor='#30363D'; this.style.background='#0D1117';">
                        <option value="">Select gender</option>
                        <option value="Male" {% if request.form.gender == 'Male' %}selected{% endif %}>Male</option>
                        <option value="Female" {% if request.form.gender == 'Female' %}selected{% endif %}>Female</option>
                        <option value="Other" {% if request.form.gender == 'Other' %}selected{% endif %}>Other</option>
                    </select>
        <div style="color: #6E7681; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">Optional - Select gender</div>
                    {% if form_errors and 'gender' in form_errors %}
            <div style="color: #F85149; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">{{ form_errors.gender }}</div>
                    {% endif %}
                </div>
    <!-- Phone Number - Optional Field -->
    <div style="margin-bottom: {{ '12px' if is_mobile else '16px' }};">
        <label for="phone_number" style="display: block; color: #B1BAC4; font-weight: 600; margin-bottom: {{ '6px' if is_mobile else '8px' }}; font-size: {{ '15px' if is_mobile else '16px' }};">
            <i class="fas fa-phone" style="margin-right: 8px; color: #1F6FEB;"></i>Phone Number
                    </label>
                    <input type="tel" 
                           id="phone_number" 
                           name="phone_number" 
               placeholder="Enter phone number" 
                           pattern="[0-9]{10}" 
                           title="Enter 10-digit phone number"
                           value="{{ request.form.phone_number if request.form.phone_number else '' }}"
               style="width: 100%; padding: {{ '10px 14px' if is_mobile else '12px 16px' }}; border: 2px solid #30363D; border-radius: 8px; background: #0D1117; color: #B1BAC4; font-size: {{ '15px' if is_mobile else '16px' }}; transition: all 0.3s ease; box-sizing: border-box;"
                           onfocus="this.style.borderColor='#1F6FEB'; this.style.background='#161B22';"
                           onblur="this.style.borderColor='#30363D'; this.style.background='#0D1117';">
        <div style="color: #6E7681; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">Optional - 10-digit phone number</div>
                    {% if form_errors and 'phone_number' in form_errors %}
            <div style="color: #F85149; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">{{ form_errors.phone_number }}</div>
                    {% endif %}
                </div>
    <!-- Ministry - Optional Field -->
    <div style="margin-bottom: {{ '12px' if is_mobile else '16px' }};">
        <label for="ministry" style="display: block; color: #B1BAC4; font-weight: 600; margin-bottom: {{ '6px' if is_mobile else '8px' }}; font-size: {{ '15px' if is_mobile else '16px' }};">
            <i class="fas fa-briefcase" style="margin-right: 8px; color: #1F6FEB;"></i>Ministry
                    </label>
                    <select id="ministry" 
                            name="ministry"
                            style="width: 100%; padding: {{ '10px 14px' if is_mobile else '12px 16px' }}; border: 2px solid #30363D; border-radius: 8px; background: #0D1117; color: #B1BAC4; font-size: {{ '15px' if is_mobile else '16px' }}; transition: all 0.3s ease; box-sizing: border-box;"
                            onfocus="this.style.borderColor='#1F6FEB'; this.style.background='#161B22';"
                            onblur="this.style.borderColor='#30363D'; this.style.background='#0D1117';">
                        <option value="">Select ministry</option>
                        <option value="Worship" {% if request.form.ministry == 'Worship' %}selected{% endif %}>Worship</option>
                        <option value="Prayer" {% if request.form.ministry == 'Prayer' %}selected{% endif %}>Prayer</option>
                        <option value="Evangelism" {% if request.form.ministry == 'Evangelism' %}selected{% endif %}>Evangelism</option>
                        <option value="Discipleship" {% if request.form.ministry == 'Discipleship' %}selected{% endif %}>Discipleship</option>
                        <option value="Fellowship" {% if request.form.ministry == 'Fellowship' %}selected{% endif %}>Fellowship</option>
                        <option value="Service" {% if request.form.ministry == 'Service' %}selected{% endif %}>Service</option>
                        <option value="Administration" {% if request.form.ministry == 'Administration' %}selected{% endif %}>Administration</option>
                        <option value="Other" {% if request.form.ministry == 'Other' %}selected{% endif %}>Other</option>
                    </select>
        <div style="color: #6E7681; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">Optional - Select ministry</div>
                    {% if form_errors and 'ministry' in form_errors %}
            <div style="color: #F85149; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">{{ form_errors.ministry }}</div>
                    {% endif %}
                </div>
    <!-- Zone - Optional Field -->
    <div style="margin-bottom: {{ '20px' if is_mobile else '24px' }};">
        <label for="zone" style="display: block; color: #B1BAC4; font-weight: 600; margin-bottom: {{ '6px' if is_mobile else '8px' }}; font-size: {{ '15px' if is_mobile else '16px' }};">
            <i class="fas fa-map-marker-alt" style="margin-right: 8px; color: #1F6FEB;"></i>Zone
                    </label>
                    <select id="zone" 
                            name="zone"
                            style="width: 100%; padding: {{ '10px 14px' if is_mobile else '12px 16px' }}; border: 2px solid #30363D; border-radius: 8px; background: #0D1117; color: #B1BAC4; font-size: {{ '15px' if is_mobile else '16px' }}; transition: all 0.3s ease; box-sizing: border-box;"
                            onfocus="this.style.borderColor='#1F6FEB'; this.style.background='#161B22';"
                            onblur="this.style.borderColor='#30363D'; this.style.background='#0D1117';">
                        <option value="">Select zone</option>
                        <option value="Zone 1" {% if request.form.zone == 'Zone 1' %}selected{% endif %}>Zone 1</option>
                        <option value="Zone 2" {% if request.form.zone == 'Zone 2' %}selected{% endif %}>Zone 2</option>
                        <option value="Zone 3" {% if request.form.zone == 'Zone 3' %}selected{% endif %}>Zone 3</option>
                        <option value="Zone 4" {% if request.form.zone == 'Zone 4' %}selected{% endif %}>Zone 4</option>
                        <option value="Zone 5" {% if request.form.zone == 'Zone 5' %}selected{% endif %}>Zone 5</option>
                        <option value="Other" {% if request.form.zone == 'Other' %}selected{% endif %}>Other</option>
                    </select>
        <div style="color: #6E7681; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">Optional - Select zone</div>
                    {% if form_errors and 'zone' in form_errors %}
            <div style="color: #F85149; font-size: {{ '12px' if is_mobile else '14px' }}; margin-top: {{ '3px' if is_mobile else '4px' }};">{{ form_errors.zone }}</div>
                    {% endif %}
                </div>
    <!-- Submit Button -->
    <div style="margin-top: {{ '24px' if is_mobile else '28px' }};">
        <button type="submit" 
                class="btn btn-primary btn-lg w-100" 
                style="padding: {{ '14px' if is_mobile else '16px' }}; font-size: {{ '16px' if is_mobile else '18px' }}; font-weight: 600; border-radius: {{ '12px' if is_mobile else '10px' }}; background: linear-gradient(135deg, #1F6FEB 0%, #0969da 100%); border: none; transition: all 0.3s ease;"
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(31, 111, 235, 0.3)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
            <i class="fas fa-plus me-2"></i>Add Member
        </button>
    </div>
        </form>
{% endmacro %}

{% block mobile_content %}
<div class="text-center mb-4">
    <div class="feature-icon mx-auto mb-3">
        <i class="fas fa-user-plus"></i>
    </div>
    <h2 class="page-title">Add New Member</h2>
    <p class="page-subtitle">Fill in the member details below</p>
</div>

<div class="card">
    <div class="card-body">
        {{ render_member_form(is_mobile=true) }}
    </div>
</div>
{% endblock %}

{% block desktop_content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="text-center mb-4">
            <div class="feature-icon mx-auto mb-3">
                <i class="fas fa-user-plus"></i>
            </div>
            <h2 class="page-title">Add New Member</h2>
            <p class="page-subtitle">Fill in the member details below</p>
        </div>

        <div class="card">
            <div class="card-body">
                {{ render_member_form(is_mobile=false) }}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('memberForm');
    const submitBtn = form.querySelector('button[type="submit"]');
    
    // Form validation
    form.addEventListener('submit', function(e) {
        const name = form.querySelector('#name').value.trim();
        
        if (!name) {
            e.preventDefault();
            alert('Please enter a name');
            return;
        }
        
        if (name.length < 2) {
            e.preventDefault();
            alert('Name must be at least 2 characters long');
            return;
        }
        
        // Show loading state
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Adding Member...';
        submitBtn.disabled = true;
    });
    
    // Real-time validation
    const nameInput = form.querySelector('#name');
    nameInput.addEventListener('input', function() {
        const value = this.value.trim();
        if (value.length >= 2) {
            this.style.borderColor = '#238636';
        } else {
            this.style.borderColor = '#30363D';
        }
    });
});
</script>
{% endblock %}
